<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üç∏ COCKTAIL COMPETITION INVITATION üçπ</title>
  <link rel="icon" type="image/png" href="images/favicon.png">
  <link rel="stylesheet" href="css/geocities.css">
  <link rel="stylesheet" href="css/invitation.css">
</head>
<body>
  <div class="invitation-container">

    <!-- Construction GIF -->
    <img src="images/construction.gif" alt="Under Construction" class="construction-gif" 
         onerror="this.style.display='none'">

    <!-- Main Header -->
    <div class="section text-center">
      <div class="header-images">
        <img src="images/cocktails.gif" alt="">
        <img src="images/absolut.gif" alt="">
        <img src="images/cocktail_stirrer.gif" alt="">
      </div>
      <h1 class="rainbow-text main-title">
        40 PROOF
      </h1>
      <h2 class="subtitle">
        *** OFFICIAL INVITATION ***
      </h2>
      <h3 class="subheading">A Birthday Cocktail Competition</h3>
    </div>

    <!-- Flame Divider -->
    <div class="flame-divider">
      <img src="images/flame-divider.gif" alt="Flame Divider" onerror="this.style.display='none'">
    </div>

    <!-- Date Banner -->
    <div class="date-banner blink">
      <img src="images/party-hats.gif" alt="" class="icon-gif">
      <span>MARCH 20TH @ 8:00 PM</span>
      <img src="images/party-hats.gif" alt="" class="icon-gif">
    </div>
    <div class="date-banner">
      <span>SEABROOK WASHINGTON</span>
    </div>

    <!-- Sparkle GIF -->
    <div class="text-center divider">
      <img src="images/sparkle.gif" alt="Sparkle" class="sparkle-decoration" onerror="this.style.display='none'">
    </div>

    <!-- Rules Section -->
    <div class="section">
      <h3>
        <img src="images/cocktail_stirrer.gif" alt="" class="icon-gif">
        THE RULES (please read carefully!!)
        <img src="images/cocktail_stirrer.gif" alt="" class="icon-gif">
      </h3>
      
      <div class="rule-item">
        <strong>1. WHAT IS A COCKTAIL???</strong><br>
        <p>
          For the purposes of this competition, a cocktail is defined as: 
          <span class="cyan-highlight">
            A DRINK MADE WITH 2 OR MORE INGREDIENTS
          </span>
          That's it!! That's the rule!!! If you mix 3 things together, congratulations, 
          you've made a cocktail!!!
          <img src="images/cocktails.gif" alt="" class="icon-gif">
        </p>
      </div>

      <div class="rule-item">
        <strong>2. THE PRESENTATION COCKTAIL</strong><br>
        <p>
          Each competitor shall prepare <u>ONE (1)</u> "presentation cocktail" - this is your 
          moment to SHINE<img src="images/sparkle.gif" alt="" class="icon-gif">!!!
          Make it fancy!! Put a little umbrella in it!!! Garnish it with 
          something impressive!!! Use a glass that makes people go "ooooh"!!! 
          <br><br>
          BUT WAIT THERE'S MORE ---&gt; All actual JUDGING will be done using a 
          <span class="red-bold">3-4 ounce standard container</span>.
          So make sure your beautiful creation can also be poured into a boring cup because 
          that's what the judges will actually taste!!!
        </p>
      </div>

      <div class="rule-item">
        <strong>3. QUANTITY MATTERS (kind of)</strong><br>
        <p>
          You need to make enough for the judges to taste!! We're talking 3-4 ounces per judge.
          How many judges will there be??? 
          <span class="highlight-bg">Good question!!! We'll figure that out later!!!</span>
          Just bring enough ingredients to make like 10 4oz servings and you'll probably be fine!!!
        </p>
      </div>
    </div>
    <!-- Sparkle Divider -->
    <div style="margin-top: -86px;" class="text-center divider divider--dragonball">
      <img src="images/dragonball.gif" alt="Sparkle" onerror="this.style.display='none'">
    </div>
    <!-- Mocktail Information -->
    <div class="section">
      <div class="mocktail-notice">
        <h3>
          <img src="images/cocktail_coke.gif" alt="" class="icon-gif large-icon">
          IMPORTANT MOCKTAIL INFORMATION
          <img src="images/cocktail_coke.gif" alt="" class="icon-gif large-icon">
        </h3>
        <br>
        Listen up folks!!! We want everyone to have a good time AND remember it the next day!!! 
        So here's the deal with mocktails:<br><br>
        
        ‚Ä¢ Providing a <strong>MOCKTAIL VERSION</strong> of your cocktail is <u>not required</u> 
        BUT it is <span class="green-highlight">HIGHLY SUGGESTED</span>!!!<br><br>
        
        ‚Ä¢ Want to submit a mocktail as your MAIN entry??? <strong>TOTALLY COOL!!!</strong><br><br>
        
        ‚Ä¢ Nobody wants to be shitfaced by 9pm so having mocktail options = SMART PLANNING!!! üß†
      </div>
    </div>

    <!-- Sparkle Divider -->
    <div  class="text-center divider">
      <img style="max-height: 36px;" src="images/red-skelton.gif" alt="Sparkle" onerror="this.style.display='none'">
    </div>

    <!-- What to Bring-->
    <div class="section">
      <ul>
        <li><img src="images/ice.gif" alt="" class="icon-gif icon-gif--lg"> Your ingredients (ALL of them!!!)</li>
        <li><img src="images/cocktails.gif" alt="" class="icon-gif icon-gif--lg"> Your tools (shakers, muddlers, whatever you need!)</li>
        <li><img src="images/drink.gif" alt="" class="icon-gif icon-gif--lg"> Your ONE fancy presentation glass</li>
        <li><img src="images/creative.gif" alt="" class="icon-gif icon-gif--lg"> Your CONFIDENCE and CREATIVITY!!!</li>
      </ul>
    </div>

    <!-- Flame Divider -->
    <div class="flame-divider">
      <img src="images/flame-divider.gif" alt="Flame Divider" onerror="this.style.display='none'">
    </div>

    <!-- Final Section -->
    <div class="section text-center final-section">
      <h2 class="blink main-heading">
        SEE YOU ON MARCH 20TH!!!
      </h2>
      <p class="large-text">
        GET READY TO MIX IT UP!!!
        <img src="images/cocktails.gif" alt="" class="icon-gif">
        <img src="images/party-hats.gif" alt="" class="icon-gif">
      </p>
      <p class="small-text">
        Questions??? Concerns??? Just want to talk about cocktails???<br>
        Hit up the organizers!!! (you know who we are)
      </p>
    </div>

    <!-- Guestbook Section -->

    <!-- Guestbook & View Counter Side by Side -->
    <div class="guestbook-counter-container">
      <!-- Guestbook Trigger -->
      <div>
        <img id="guestbookTrigger" class="guestbook-trigger" alt="Click to sign guestbook!" style="cursor: pointer;">
      </div>

      <!-- View Counter -->
      <div class="view-counter-container">
        <p class="page-views-header">
          <img src="images/party-hats.gif" alt="" class="icon-gif">
          PAGE VIEWS
          <img src="images/party-hats.gif" alt="" class="icon-gif">
        </p>
        <div class="view-counter" id="viewCounter">
          <!-- Counter digits will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Guestbook Modal/Popup -->
    <div id="guestbookModal" class="guestbook-modal" style="display: none;">
      <div class="guestbook-modal-overlay"></div>
      <div class="guestbook-modal-content">
        <button id="closeGuestbook" class="guestbook-close">‚ùå CLOSE</button>
        
        <h2 class="text-center rainbow-text">
          <img src="images/sparkle.gif" alt="" class="icon-gif">
          SIGN THE GUESTBOOK!!!
          <img src="images/sparkle.gif" alt="" class="icon-gif">
        </h2>
        
        <!-- Guestbook Form -->
        <div class="guestbook-form">
          <input type="text" id="guestName" placeholder="Your Name" maxlength="50">
          <textarea id="guestMessage" placeholder="Leave a message!!!" rows="3" maxlength="200"></textarea>
          <button id="signGuestbook">SIGN IT!!!</button>
          <div id="guestbookError" class="error-message"></div>
        </div>

        <!-- Guestbook Entries -->
        <div id="guestbookEntries" class="guestbook-entries">
          <p class="text-center">Loading guestbook entries...</p>
        </div>
      </div>
    </div>

    <!-- Footer Attribution -->
    <div class="footer-text">
      <p>Favicon created by Arthur Shlain from the Noun Project</p>
    </div>

  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
    
    const SUPABASE_URL = 'https://pvvkkcqxkwlzfwlladoe.supabase.co'
    const SUPABASE_KEY = 'sb_publishable_INEqArDABXzb2p2YjiwhJA_jlj_4Q2y'
    
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

    // View counter using Supabase
    async function updateViewCounter() {
      const counterElement = document.getElementById('viewCounter');
      
      try {
        // Increment the view count
        const { data, error } = await supabase.rpc('increment_page_views', {
          page_name_input: 'invitation'
        });

        if (error) {
          // Fallback: try manual increment
          const { data: currentData, error: fetchError } = await supabase
            .from('page_views')
            .select('view_count')
            .eq('page_name', 'invitation')
            .single();

          if (fetchError) throw fetchError;

          const newCount = (currentData?.view_count || 0) + 1;

          const { error: updateError } = await supabase
            .from('page_views')
            .update({ view_count: newCount, updated_at: new Date().toISOString() })
            .eq('page_name', 'invitation');

          if (updateError) throw updateError;

          displayCounter(newCount);
        } else {
          displayCounter(data);
        }
      } catch (err) {
        console.error('Error updating view counter:', err);
        // Fallback to localStorage if Supabase fails
        let views = parseInt(localStorage.getItem('invitation_page_views') || '0', 10);
        views++;
        localStorage.setItem('invitation_page_views', views.toString());
        displayCounter(views);
      }
    }

    function displayCounter(views) {
      const viewsStr = views.toString().padStart(6, '0');
      const counterElement = document.getElementById('viewCounter');
      
      counterElement.innerHTML = '';
      for (let i = 0; i < viewsStr.length; i++) {
        const digitBox = document.createElement('div');
        digitBox.className = 'counter-digit';
        digitBox.textContent = viewsStr[i];
        counterElement.appendChild(digitBox);
      }
    }

    // Load guestbook entries
    async function loadGuestbook() {
      const container = document.getElementById('guestbookEntries');
      
      try {
        const { data, error } = await supabase
          .from('guestbook')
          .select('*')
          .order('created_at', { ascending: false })
          .limit(20);

        if (error) throw error;

        if (!data || data.length === 0) {
          container.innerHTML = '<p class="text-center">No entries yet!!! Be the first to sign!!!</p>';
          return;
        }

        container.innerHTML = data.map(entry => `
          <div class="guestbook-entry">
            <div class="entry-header">
              <span class="entry-name">${escapeHtml(entry.name)}</span>
              <span class="entry-date">${new Date(entry.created_at).toLocaleDateString()}</span>
            </div>
            <div class="entry-message">${escapeHtml(entry.message)}</div>
          </div>
        `).join('');

      } catch (err) {
        container.innerHTML = `<p class="text-center" style="color: #FF0000;">Error loading guestbook: ${err.message}</p>`;
      }
    }

    // Sign guestbook
    async function signGuestbook() {
      const nameInput = document.getElementById('guestName');
      const messageInput = document.getElementById('guestMessage');
      const errorDiv = document.getElementById('guestbookError');
      const button = document.getElementById('signGuestbook');

      const name = nameInput.value.trim();
      const message = messageInput.value.trim();

      errorDiv.textContent = '';
      errorDiv.style.color = '#FF0000';

      if (!name || !message) {
        errorDiv.textContent = 'Please fill in both fields!!!';
        return;
      }

      button.disabled = true;
      button.textContent = 'SIGNING...';

      try {
        const { error } = await supabase
          .from('guestbook')
          .insert([{ name, message }]);

        if (error) throw error;

        // Show success message
        errorDiv.style.color = '#00FF00';
        errorDiv.textContent = '‚úì SUCCESS!!! Your message has been signed!!!';

        // Clear form
        nameInput.value = '';
        messageInput.value = '';

        // Reload entries
        await loadGuestbook();

        // Clear success message after 3 seconds
        setTimeout(() => {
          errorDiv.textContent = '';
        }, 3000);

      } catch (err) {
        errorDiv.style.color = '#FF0000';
        errorDiv.textContent = `Error: ${err.message}`;
      } finally {
        button.disabled = false;
        button.textContent = 'SIGN IT!!!';
      }
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Run on page load
    updateViewCounter();
    
    // Guestbook image rotation
    const guestbookImages = [
      'images/guestbook_fire.gif',
      'images/guestbook_jessica_simpson.gif',
      'images/guestbook_lion.gif',
      'images/guestbook_rock.gif',
      'images/guestbook_unicorn.gif'
    ];
    
    // Select random guestbook image on page load
    const randomImage = guestbookImages[Math.floor(Math.random() * guestbookImages.length)];
    document.getElementById('guestbookTrigger').src = randomImage;
    
    // Show guestbook modal on trigger click
    document.getElementById('guestbookTrigger').addEventListener('click', function() {
      document.getElementById('guestbookModal').style.display = 'block';
      document.body.style.overflow = 'hidden'; // Prevent scrolling
      loadGuestbook(); // Load entries when modal opens
    });
    
    // Close guestbook modal
    function closeGuestbookModal() {
      document.getElementById('guestbookModal').style.display = 'none';
      document.body.style.overflow = 'auto'; // Re-enable scrolling
    }
    
    document.getElementById('closeGuestbook').addEventListener('click', closeGuestbookModal);
    
    // Close on overlay click
    document.querySelector('.guestbook-modal-overlay').addEventListener('click', closeGuestbookModal);

    // Sign guestbook button
    document.getElementById('signGuestbook').addEventListener('click', signGuestbook);
  </script>
</body>
</html>
